<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>WhomeAI Demo - Tạo ảnh từ prompt</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 800px;
      margin: 20px auto;
    }
    textarea {
      width: 100%;
      min-height: 80px;
    }
    .controls {
      margin: 10px 0;
    }
    #result {
      margin-top: 20px;
    }
    #result img {
      max-width: 100%;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>WhomeAI Image Generation Demo</h1>

  <label for="prompt">Mô tả ảnh (prompt):</label>
  <textarea id="prompt"
    placeholder="Ví dụ: A cat on the moon"></textarea>

  <div class="controls">
    <label for="size">Kích thước:</label>
    <select id="size">
      <option value="1024x1024">1024x1024 (Vuông)</option>
      <option value="1792x1024">1792x1024 (Ngang)</option>
      <option value="1024x1792">1024x1792 (Dọc)</option>
    </select>

    <label for="count">Số ảnh:</label>
    <select id="count">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
    </select>

    <button id="generateBtn">Tạo ảnh</button>
  </div>

  <div id="status"></div>
  <div id="result"></div>

  <script>
    const API_URL = "https://api.whomeai.com/v1/images/generations";
    const API_KEY = "sk-demo"; // CHỈ DEMO, không dùng key thật trên frontend

    document.getElementById("generateBtn").addEventListener("click", async () => {
      const prompt = document.getElementById("prompt").value.trim();
      const size = document.getElementById("size").value;
      const n = parseInt(document.getElementById("count").value, 10);
      const statusEl = document.getElementById("status");
      const resultEl = document.getElementById("result");

      if (!prompt) {
        alert("Bạn hãy nhập prompt trước đã nhé!");
        return;
      }

      statusEl.textContent = "Đang tạo ảnh...";
      resultEl.innerHTML = "";

      try {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + API_KEY,
          },
          body: JSON.stringify({
            model: "nano-banana",
            prompt: prompt,
            n: n,
            size: size,
            // seed: 666666,          // nếu muốn cố định seed như docs
            // response_format: "b64_json" // mặc định đã là b64_json
          }),
        });

        if (!response.ok) {
          const errorText = await response.text();
          throw new Error("Lỗi API: " + errorText);
        }

        const data = await response.json();
        console.log(data);

        statusEl.textContent = "Tạo ảnh thành công!";

        // data.data là mảng, mỗi phần tử có b64_json
        data.data.forEach((item, index) => {
          const img = document.createElement("img");
          img.src = "data:image/png;base64," + item.b64_json;
          img.alt = item.revised_prompt || prompt;

          const wrapper = document.createElement("div");
          wrapper.style.marginBottom = "10px";
          const title = document.createElement("p");
          title.textContent = "Ảnh #" + (index + 1);
          wrapper.appendChild(title);
          wrapper.appendChild(img);

          resultEl.appendChild(wrapper);
        });
      } catch (err) {
        console.error(err);
        statusEl.textContent = "Có lỗi xảy ra: " + err.message;
      }
    });
  </script>
</body>
</html>
